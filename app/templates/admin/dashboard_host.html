<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Dashboard</title>
    <!-- Font Awesome CDN (v6) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        integrity="sha512-TFzN+3HkW2x6UAgAlrC8k5iYZv5hS6RJKLkYoN0Kq1G7s7fTtWqj93B35KkA0GfQ3Iez+zV2YBJ2r3x+AKL2sw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Admin Dashboard Styles */
        .admin-dashboard {
            min-height: 100vh;
            background: #f8f9fa;
        }

        .admin-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            background: #ffffff;
            color: #333;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.08);
            border-right: 1px solid #e9ecef;
        }

        .admin-sidebar.collapsed {
            transform: translateX(-100%);
        }

        .admin-main {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
            background: #f8f9fa;
        }

        .admin-main.expanded {
            margin-left: 0;
        }

        .admin-header {
            background: #ffffff;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #e9ecef;
        }

        .admin-content {
            padding: 2rem;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            color: white;
        }

        .sidebar-header img {
            width: 50px;
            height: 50px;
            margin-bottom: 1rem;
        }

        .sidebar-header h3 {
            color: #ffffff;
            font-size: 1.2rem;
            margin: 0;
            font-weight: 600;
        }

        .sidebar-header p {
            color: #e3f2fd;
            margin: 0.5rem 0 0 0;
            font-size: 0.85rem;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section-title {
            padding: 0.75rem 1.5rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #6c757d;
            font-weight: 600;
            letter-spacing: 1px;
            background: #f8f9fa;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            display: block;
            padding: 0.875rem 1.5rem;
            color: #495057;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-item:hover {
            background: #f8f9fa;
            border-left-color: #003366;
            color: #003366;
            text-decoration: none;
        }

        .nav-item.active {
            background: #e3f2fd;
            border-left-color: #003366;
            color: #003366;
            font-weight: 600;
        }

        .nav-item i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
            color: #6c757d;
        }

        .nav-item:hover i,
        .nav-item.active i {
            color: #003366;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 1.75rem;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #003366, #004080);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .stat-title {
            font-size: 0.875rem;
            color: #6c757d;
            font-weight: 500;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            background: linear-gradient(135deg, #003366, #004080);
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            line-height: 1;
        }

        .stat-change {
            font-size: 0.8rem;
            color: #28a745;
            margin-top: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.negative {
            color: #dc3545;
        }

        .content-section {
            background: #ffffff;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.75rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f8f9fa;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .btn-primary-admin {
            background: linear-gradient(135deg, #003366, #004080);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary-admin:hover {
            background: linear-gradient(135deg, #004080, #0056b3);
            color: white;
            text-decoration: none;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 51, 102, 0.25);
        }

        .btn-secondary-admin {
            background: #6c757d;
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .btn-secondary-admin:hover {
            background: #5a6268;
            color: white;
            text-decoration: none;
        }

        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #e9ecef;
        }

        .admin-table {
            margin: 0;
        }

        .admin-table th {
            background: #f8f9fa;
            border: none;
            padding: 1.25rem 1rem;
            font-weight: 600;
            color: #495057;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-table td {
            padding: 1.25rem 1rem;
            border: none;
            border-bottom: 1px solid #f8f9fa;
            vertical-align: middle;
            color: #495057;
        }

        .admin-table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.375rem 0.875rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-badge.approved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-badge.rejected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-badge.active {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: #003366;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background 0.3s ease;
        }

        .mobile-toggle:hover {
            background: #f8f9fa;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #003366, #004080);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: #6c757d;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.active {
                transform: translateX(0);
            }

            .admin-main {
                margin-left: 0;
            }

            .mobile-toggle {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .admin-content {
                padding: 1rem;
            }

            .content-section {
                padding: 1.5rem;
            }

            .admin-header {
                padding: 1rem 1.5rem;
            }
        }

        @media (max-width: 576px) {
            .admin-header {
                padding: 1rem;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .user-info {
                flex-direction: column;
                align-items: flex-end;
                gap: 0.5rem;
            }
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003366;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Modal Styles */
        .modal-admin {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content-admin {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid #e9ecef;
        }

        .modal-header-admin {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f8f9fa;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #dc3545;
            background: #f8f9fa;
        }

        /* Form Styles */
        .form-control {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #003366;
            box-shadow: 0 0 0 0.2rem rgba(0, 51, 102, 0.25);
        }

        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        /* Button Groups */
        .btn-group-admin {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        /* Card Variations */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        /* Text Utilities */
        .text-muted {
            color: #6c757d !important;
        }

        .text-primary {
            color: #003366 !important;
        }

        .text-success {
            color: #28a745 !important;
        }

        .text-warning {
            color: #ffc107 !important;
        }

        .text-danger {
            color: #dc3545 !important;
        }

        /* Error message styling */
        .text-center {
            text-align: center !important;
        }

        .admin-table td.text-center {
            padding: 2rem 1rem;
            color: #6c757d;
            font-style: italic;
        }

        /* File Manager Styles */
        .image-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .image-item:hover {
            border-color: #007bff !important;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
        }

        .image-item.selected {
            border-color: #007bff !important;
            background-color: #e3f2fd;
        }

        .image-item img {
            border-radius: 4px;
        }

        .list-group-item.active {
            background-color: #007bff;
            border-color: #007bff;
        }

        /* VIP Management Styles */
        .vip-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .vip-card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .vip-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
        }

        .vip-image {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .vip-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .no-image-placeholder {
            width: 100%;
            height: 100%;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 0.9rem;
            font-weight: 500;
            border: 2px dashed #dee2e6;
        }

        .vip-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .vip-status.active {
            background-color: #28a745;
            color: white;
        }

        .vip-status.inactive {
            background-color: #6c757d;
            color: white;
        }

        .vip-info {
            padding: 1.5rem;
        }

        .vip-info h4 {
            margin: 0 0 0.5rem 0;
            color: #333;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .vip-designation {
            color: #007bff;
            font-weight: 500;
            margin: 0 0 0.5rem 0;
            font-size: 0.9rem;
        }

        .vip-company {
            color: #6c757d;
            margin: 0 0 0.5rem 0;
            font-size: 0.85rem;
        }

        .vip-description {
            color: #666;
            font-size: 0.85rem;
            line-height: 1.4;
            margin: 0 0 1rem 0;
        }

        .vip-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Enhanced Gallery Management Styles */
        .gallery-upload-section {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            background: #f8f9fa;
        }

        .drag-drop-area {
            position: relative;
            border: 2px dashed #ced4da;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background: #ffffff;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .drag-drop-area:hover,
        .drag-drop-area.drag-over {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .drag-drop-content h5 {
            color: #495057;
            margin-bottom: 0.5rem;
        }

        .upload-progress {
            margin-top: 1rem;
        }

        .gallery-preview-container {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            background: #ffffff;
        }

        .gallery-item-card {
            position: relative;
            background: #ffffff;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .gallery-item-card:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
        }

        .gallery-item-card.editing {
            border-color: #28a745;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
        }

        .gallery-item-header {
            position: relative;
            height: 120px;
            overflow: hidden;
        }

        .gallery-item-header img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .gallery-item-order {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .gallery-item-body {
            padding: 1rem;
        }

        .gallery-item-filename {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .gallery-description-textarea {
            resize: vertical;
            min-height: 60px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 0.5rem;
            width: 100%;
            font-size: 0.9rem;
        }

        .gallery-description-textarea:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .gallery-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .gallery-grid-view .gallery-item-card {
            margin-bottom: 1rem;
        }

        .gallery-list-view .gallery-item-card {
            display: flex;
            margin-bottom: 0.5rem;
        }

        .gallery-list-view .gallery-item-header {
            width: 150px;
            height: 80px;
            flex-shrink: 0;
        }

        .gallery-list-view .gallery-item-body {
            flex: 1;
            padding: 0.75rem;
        }

        .gallery-sort-indicator {
            color: #007bff;
            margin-left: 0.5rem;
        }

        .badge-info {
            background-color: #17a2b8;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        /* Image Status Indicators */
        .image-status {
            position: absolute;
            bottom: 5px;
            left: 5px;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .image-status.new {
            background: #28a745;
            color: white;
        }

        .image-status.edited {
            background: #ffc107;
            color: #212529;
        }

        .image-status.existing {
            background: #17a2b8;
            color: white;
        }

        .image-status.error {
            background: #dc3545;
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .gallery-item-card {
                margin-bottom: 0.5rem;
            }

            .gallery-item-header {
                height: 100px;
            }

            .gallery-actions {
                flex-wrap: wrap;
            }

            .drag-drop-area {
                padding: 1rem;
                min-height: 100px;
            }

            .vip-actions {
                flex-direction: column;
                gap: 0.25rem;
            }

            .vip-actions .btn {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }

            .gallery-management-toolbar .d-flex {
                flex-direction: column;
                gap: 1rem;
            }

            .gallery-management-toolbar .btn {
                font-size: 0.8rem;
                padding: 0.375rem 0.75rem;
            }
        }

        @media (max-width: 576px) {
            .admin-main {
                margin-left: 0;
            }

            .admin-sidebar {
                transform: translateX(-100%);
            }

            .modal-content-admin {
                margin: 1rem;
                max-width: calc(100% - 2rem);
            }

            .gallery-upload-section {
                padding: 0.5rem;
            }

            .drag-drop-area {
                padding: 1rem 0.5rem;
                min-height: 80px;
            }

            .gallery-preview-container {
                padding: 0.5rem;
            }
        }

        /* Enhanced button styles */
        .btn-danger-admin {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .btn-danger-admin:hover {
            background-color: #c82333;
            border-color: #bd2130;
            color: white;
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Success animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .vip-actions .btn {
            flex: 1;
            font-size: 0.8rem;
            padding: 0.375rem 0.75rem;
        }
    </style>
</head>

<body>
    <div class="admin-dashboard">
        <!-- Sidebar -->
        <div class="admin-sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <img src="/static/images/logo/transLogo.png" alt="TACCI Logo">
                <h3>Admin Panel</h3>
                <p>Welcome, {{ current_user.username }}</p>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <a href="#dashboard" class="nav-item active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Overview
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Content Management</div>
                    <a href="#members" class="nav-item" data-section="members">
                        <i class="fas fa-users"></i> Members
                    </a>
                    <a href="#events" class="nav-item" data-section="events">
                        <i class="fas fa-calendar-alt"></i> Events
                    </a>
                    <a href="#brochure" class="nav-item" data-section="brochure">
                        <i class="fas fa-calendar-alt"></i> Download Brochure
                    </a>
                    <a href="#news" class="nav-item" data-section="news">
                        <i class="fas fa-newspaper"></i> News & Articles
                    </a>
                    <a href="#gallery" class="nav-item" data-section="gallery">
                        <i class="fas fa-images"></i> Gallery
                    </a>
                    <a href="#vip" class="nav-item" data-section="vip">
                        <i class="fas fa-crown"></i> VIP Management
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Inquiries & Forms</div>
                    <a href="#export-inquiries" class="nav-item" data-section="export-inquiries">
                        <i class="fas fa-upload"></i> Export Inquiries
                    </a>
                    <a href="#import-inquiries" class="nav-item" data-section="import-inquiries">
                        <i class="fas fa-download"></i> Import Inquiries
                    </a>
                    <a href="#business-opportunities" class="nav-item" data-section="business-opportunities">
                        <i class="fas fa-briefcase"></i> Business Opportunities
                    </a>
                    <a href="#suggestions" class="nav-item" data-section="suggestions">
                        <i class="fas fa-lightbulb"></i> Suggestions
                    </a>
                    <a href="#complaints" class="nav-item" data-section="complaints">
                        <i class="fas fa-exclamation-triangle"></i> Complaints
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Event Management</div>
                    <a href="#past-events" class="nav-item" data-section="past-events">
                        <i class="fas fa-user-shield"></i> Past Events
                    </a>
                    <a href="#budget-events" class="nav-item" data-section="budget-events">
                        <i class="fas fa-user-shield"></i> Budget Events
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <a href="#users" class="nav-item" data-section="users">
                        <i class="fas fa-user-shield"></i> User Management
                    </a>
                    <a href="#settings" class="nav-item" data-section="settings">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                    <a href="{{ url_for('main.logout') }}" class="nav-item">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="admin-main" id="adminMain">
            <!-- Header -->
            <div class="admin-header">
                <div class="d-flex align-items-center">
                    <button class="mobile-toggle" id="mobileToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h4 class="mb-0 ms-3">Admin Dashboard</h4>
                </div>

                <div class="user-info">
                    <div class="user-avatar">
                        {{ current_user.username[0].upper() }}
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{ current_user.username }}</div>
                        <div class="user-role">Administrator</div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="admin-content">
                <!-- Dashboard Overview Section -->
                <div id="dashboard-section" class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Dashboard Overview</h2>
                        <div>
                            <span class="text-muted">Last updated: <span id="lastUpdated"></span></span>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="stats-grid">
                        <div class="stat-card card-hover">
                            <div class="stat-header">
                                <h6 class="stat-title">Total Members</h6>
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <h3 class="stat-value" id="totalMembers">0</h3>
                        </div>

                        <div class="stat-card card-hover">
                            <div class="stat-header">
                                <h6 class="stat-title">Active Events</h6>
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                            </div>
                            <h3 class="stat-value" id="activeEvents">0</h3>
                            <div class="stat-change">
                                <i class="fas fa-arrow-up"></i> +5% this week
                            </div>
                        </div>

                        <div class="stat-card card-hover">
                            <div class="stat-header">
                                <h6 class="stat-title">Active Brochure</h6>
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                            </div>
                            <h3 class="stat-value" id="activeBrochure">0</h3>
                            <div class="stat-change">
                                <i class="fas fa-arrow-up"></i> +5% this week
                            </div>
                        </div>

                        <div class="stat-card card-hover">
                            <div class="stat-header">
                                <h6 class="stat-title">Pending Inquiries</h6>
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <h3 class="stat-value" id="pendingInquiries">0</h3>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-down"></i> -8% this week
                            </div>
                        </div>

                        <div class="stat-card card-hover">
                            <div class="stat-header">
                                <h6 class="stat-title">Total Revenue</h6>
                                <div class="stat-icon">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                            </div>
                            <h3 class="stat-value" id="totalRevenue">$0</h3>
                            <div class="stat-change">
                                <i class="fas fa-arrow-up"></i> +15% this month
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="content-section">
                                <div class="section-header">
                                    <h3 class="section-title">Recent Activity</h3>
                                    <a href="#" class="btn-primary-admin">
                                        <i class="fas fa-eye"></i> View All
                                    </a>
                                </div>
                                <div class="table-responsive">
                                    <table class="table admin-table">
                                        <thead>
                                            <tr>
                                                <th>Activity</th>
                                                <th>User</th>
                                                <th>Time</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentActivity">
                                            <tr>
                                                <td>New member registration</td>
                                                <td>John Doe</td>
                                                <td>2 hours ago</td>
                                                <td><span class="status-badge approved">Approved</span></td>
                                            </tr>
                                            <tr>
                                                <td>Event created</td>
                                                <td>Admin</td>
                                                <td>4 hours ago</td>
                                                <td><span class="status-badge active">Active</span></td>
                                            </tr>
                                            <tr>
                                                <td>Export inquiry submitted</td>
                                                <td>Jane Smith</td>
                                                <td>6 hours ago</td>
                                                <td><span class="status-badge pending">Pending</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="content-section">
                                <div class="section-header">
                                    <h3 class="section-title">Quick Actions</h3>
                                </div>
                                <div class="d-grid gap-2">
                                    <button class="btn-primary-admin" onclick="openModal('addMember')">
                                        <i class="fas fa-user-plus"></i> Add New Member
                                    </button>
                                    <button class="btn-primary-admin" onclick="openModal('addEvent')">
                                        <i class="fas fa-calendar-plus"></i> Create Event
                                    </button>
                                    <button class="btn-primary-admin" onclick="openModal('addNews')">
                                        <i class="fas fa-newspaper"></i> Publish News
                                    </button>
                                    <button class="btn-primary-admin" onclick="openModal('uploadImage')">
                                        <i class="fas fa-upload"></i> Upload Image
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Members Section -->
                <div id="members-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Member Management</h2>
                        <button class="btn-primary-admin" onclick="openModal('addMember')">
                            <i class="fas fa-plus"></i> Add Member
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Company</th>
                                    <th>Email</th>
                                    <th>Membership Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="membersTable">
                                <!-- Members will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Events Section -->
                <div id="events-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Event Management</h2>
                        <button class="btn-primary-admin" onclick="openModal('addEvent')">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                    </div>
                </div>

                <!-- Brchure Section -->
                <div id="brochure-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Brochure Management</h2>
                        <div>
                            <span class="badge bg-primary" id="brochureCount">0</span> Total Brochure Inquiries
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Company</th>
                                    <th>Country</th>
                                    <th>Interest</th>
                                    <th>Submitted Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="brochureTable">
                                <!-- Events will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Export Inquiries Section -->
                <div id="export-inquiries-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Export Inquiries</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="exportToCSV('export-inquiries')">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Company</th>
                                    <th>Email</th>
                                    <th>Product Details</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="exportInquiriesTable">
                                {% for inquiry in export_inquiries %}
                                <tr>
                                    <td>{{ inquiry.full_name }}</td>
                                    <td>{{ inquiry.company_name }}</td>
                                    <td>{{ inquiry.email }}</td>
                                    <td>{{ inquiry.product_details[:50] }}{% if inquiry.product_details|length > 50
                                        %}...{%
                                        endif %}</td>
                                    <td>{{ inquiry.submitted_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>
                                        <div class="btn-group-admin">
                                            <button class="btn btn-sm btn-outline-primary"
                                                onclick="viewDetails('export-inquiry', '{{ inquiry.id }}')">View</button>
                                            <button class="btn btn-sm btn-outline-success"
                                                onclick="approveInquiry('export-inquiry', '{{ inquiry.id }}')">Approve</button>
                                            <button class="btn btn-sm btn-outline-danger"
                                                onclick="deleteInquiry('export-inquiry', '{{ inquiry.id }}')">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Import Inquiries Section -->
                <div id="import-inquiries-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Import Inquiries</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="exportToCSV('import-inquiries')">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Company</th>
                                    <th>Email</th>
                                    <th>Product Details</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="importInquiriesTable">
                                {% for inquiry in import_inquiries %}
                                <tr>
                                    <td>{{ inquiry.full_name }}</td>
                                    <td>{{ inquiry.company_name }}</td>
                                    <td>{{ inquiry.email }}</td>
                                    <td>{{ inquiry.product_details[:50] }}{% if inquiry.product_details|length > 50
                                        %}...{%
                                        endif %}</td>
                                    <td>{{ inquiry.submitted_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>
                                        <div class="btn-group-admin">
                                            <button class="btn btn-sm btn-outline-primary"
                                                onclick="viewDetails('import-inquiry', '{{ inquiry.id }}')">View</button>
                                            <button class="btn btn-sm btn-outline-success"
                                                onclick="approveInquiry('import-inquiry', '{{ inquiry.id }}')">Approve</button>
                                            <button class="btn btn-sm btn-outline-danger"
                                                onclick="deleteInquiry('import-inquiry', '{{ inquiry.id }}')">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Business Opportunities Section -->
                <div id="business-opportunities-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Business Opportunities</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="exportToCSV('business-opportunities')">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Opportunity</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="businessOpportunitiesTable">
                                {% for opportunity in business_opportunities %}
                                <tr>
                                    <td>{{ opportunity.full_name }}</td>
                                    <td>{{ opportunity.email }}</td>
                                    <td>{{ opportunity.phone_number }}</td>
                                    <td>{{ opportunity.business_opportunity[:50] }}{% if
                                        opportunity.business_opportunity|length > 50 %}...{% endif %}</td>
                                    <td>{{ opportunity.submitted_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>
                                        <div class="btn-group-admin">
                                            <button class="btn btn-sm btn-outline-primary"
                                                onclick="viewDetails('business-opportunity', '{{ opportunity.id }}')">View</button>
                                            <button class="btn btn-sm btn-outline-success"
                                                onclick="approveInquiry('business-opportunity', '{{ opportunity.id }}')">Approve</button>
                                            <button class="btn btn-sm btn-outline-danger"
                                                onclick="deleteInquiry('business-opportunity', '{{ opportunity.id }}')">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Suggestions Section -->
                <div id="suggestions-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Suggestions</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="exportToCSV('suggestions')">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Suggestion</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="suggestionsTable">
                                {% for suggestion in suggestions %}
                                <tr>
                                    <td>{{ suggestion.full_name }}</td>
                                    <td>{{ suggestion.email }}</td>
                                    <td>{{ suggestion.phone_number }}</td>
                                    <td>{{ suggestion.suggestions[:50] }}{% if suggestion.suggestions|length > 50
                                        %}...{%
                                        endif %}</td>
                                    <td>{{ suggestion.submitted_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>
                                        <div class="btn-group-admin">
                                            <button class="btn btn-sm btn-outline-primary"
                                                onclick="viewDetails('suggestion', '{{ suggestion.id }}')">View</button>
                                            <button class="btn btn-sm btn-outline-success"
                                                onclick="approveInquiry('suggestion', '{{ suggestion.id }}')">Approve</button>
                                            <button class="btn btn-sm btn-outline-danger"
                                                onclick="deleteInquiry('suggestion', '{{ suggestion.id }}')">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Complaints Section -->
                <div id="complaints-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Complaints</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="exportToCSV('complaints')">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Complaint</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="complaintsTable">
                                {% for complaint in complaints %}
                                <tr>
                                    <td>{{ complaint.full_name }}</td>
                                    <td>{{ complaint.email }}</td>
                                    <td>{{ complaint.phone_number }}</td>
                                    <td>{{ complaint.complaints[:50] }}{% if complaint.complaints|length > 50 %}...{%
                                        endif
                                        %}</td>
                                    <td>{{ complaint.submitted_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>
                                        <div class="btn-group-admin">
                                            <button class="btn btn-sm btn-outline-primary"
                                                onclick="viewDetails('complaint', '{{ complaint.id }}')">View</button>
                                            <button class="btn btn-sm btn-outline-success"
                                                onclick="approveInquiry('complaint', '{{ complaint.id }}')">Resolve</button>
                                            <button class="btn btn-sm btn-outline-danger"
                                                onclick="deleteInquiry('complaint', '{{ complaint.id }}')">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Past Events Section -->
                <div id="past-events-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Past Events</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="openAddPastEventModal()">
                                <i class="fas fa-plus"></i> Add Past Event
                            </button>
                        </div>
                    </div>

                    <div class="vip-grid" id="pastEventsGrid">
                        <!-- Past event cards will be loaded here -->
                    </div>
                </div>

                <!-- Budget Events Section -->
                <div id="budget-events-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Budget Events</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="openAddBudgetEventModal()">
                                <i class="fas fa-plus"></i> Add Budget Event
                            </button>
                        </div>
                    </div>

                    <div class="vip-grid" id="budgetEventsGrid">
                        <!-- Budget event cards will be loaded here -->
                    </div>
                </div>

                <!-- VIP Management Section -->
                <div id="vip-section" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">VIP Management</h2>
                        <div>
                            <button class="btn-primary-admin" onclick="openAddVipModal()">
                                <i class="fas fa-plus"></i> Add New VIP
                            </button>
                        </div>
                    </div>

                    <div class="vip-grid" id="vipGrid">
                        <!-- VIP cards will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Past Events Modal -->
    <div id="pastEventModal" class="modal-admin" style="display: none;">
        <div class="modal-content-admin">
            <div class="modal-header-admin">
                <h4 class="modal-title" id="pastEventModalTitle">Add Past Event</h4>
                <button class="close-modal" onclick="closePastEventModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pastEventForm" enctype="multipart/form-data">
                    <input type="hidden" id="pastEventId" name="past_event_id">
                    <div class="form-group">
                        <label for="peTitle">Title</label>
                        <input type="text" class="form-control" id="peTitle" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="peDate">Event Date</label>
                        <input type="date" class="form-control" id="peDate" name="event_date">
                    </div>
                    <div class="form-group">
                        <label for="peBanner">Banner Image</label>
                        <input type="file" class="form-control" id="peBanner" name="banner_image" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label>Gallery Images <span class="badge badge-info" id="gallery-count">0</span>/30</label>
                        <div class="gallery-upload-section">
                            <!-- Drag and Drop Area -->
                            <div class="drag-drop-area" id="dragDropArea" ondrop="handleDrop(event)"
                                ondragover="allowDrop(event)" ondragleave="removeDragOver(event)">
                                <div class="drag-drop-content">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                    <h5>Drag & Drop Images Here</h5>
                                    <p class="text-muted">or click to browse files</p>
                                    <input type="file" class="form-control" id="gallery_images" multiple
                                        accept="image/*" onchange="handleGalleryFiles(this)"
                                        style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer;">
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex gap-2 mt-3 mb-2">
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addSingleImage()">
                                    <i class="fas fa-plus"></i> Add Single Image
                                </button>
                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addBulkImages()">
                                    <i class="fas fa-images"></i> Add Bulk Images (Up to 30)
                                </button>
                                <button type="button" class="btn btn-outline-warning btn-sm"
                                    onclick="sortGalleryImages()">
                                    <i class="fas fa-sort"></i> Sort Images
                                </button>
                                <button type="button" class="btn btn-outline-danger btn-sm"
                                    onclick="clearGalleryImages()">
                                    <i class="fas fa-trash"></i> Clear All
                                </button>
                            </div>

                            <!-- Progress Bar -->
                            <div class="upload-progress" id="uploadProgress" style="display: none;">
                                <div class="progress mb-2">
                                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted" id="progressText">Preparing images...</small>
                            </div>
                        </div>

                        <!-- Gallery Preview with Enhanced Features -->
                        <div class="gallery-preview-container mt-3">
                            <div class="gallery-header d-flex justify-content-between align-items-center mb-3"
                                style="display: none !important;" id="galleryHeader">
                                <h6 class="mb-0">Image Gallery Preview</h6>
                                <div class="gallery-actions">
                                    <button type="button" class="btn btn-sm btn-outline-secondary"
                                        onclick="toggleGalleryView()">
                                        <i class="fas fa-th" id="viewToggleIcon"></i> Grid View
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary"
                                        onclick="previewGallery()">
                                        <i class="fas fa-eye"></i> Preview
                                    </button>
                                </div>
                            </div>
                            <div class="row" id="gallery-images-list"></div>
                        </div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary-admin"
                            onclick="closePastEventModal()">Cancel</button>
                        <button type="button" class="btn-primary-admin" onclick="savePastEvent()">Save Past
                            Event</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Images to Past Event Modal -->
    <div id="pastEventImagesModal" class="modal-admin" style="display: none;">
        <div class="modal-content-admin">
            <div class="modal-header-admin">
                <h4 class="modal-title">Add Images to Past Event</h4>
                <button class="close-modal" onclick="closePastEventImagesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pastEventImagesForm" enctype="multipart/form-data">
                    <input type="hidden" id="pastEventImagesEventId">
                    <div class="form-group">
                        <label>Gallery Images</label>
                        <input type="file" class="form-control" id="peImagesInput" multiple accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="peImagesDescriptions">Descriptions (one per image, line by line)</label>
                        <textarea class="form-control" id="peImagesDescriptions" rows="4"></textarea>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary-admin"
                            onclick="closePastEventImagesModal()">Cancel</button>
                        <button type="button" class="btn-primary-admin" onclick="addImagesToPastEvent()">Add
                            Images</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Enhanced Image Editor Modal -->
    <div id="imageEditorModal" class="modal-admin" style="display: none;">
        <div class="modal-content-admin" style="max-width: 800px;">
            <div class="modal-header-admin">
                <h4 class="modal-title">Edit Image Details</h4>
                <button class="close-modal" onclick="closeImageEditorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="image-preview-container mb-3">
                            <img id="editImagePreview" src="" alt="Image Preview"
                                style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px;">
                        </div>
                        <div class="image-info">
                            <small class="text-muted">
                                <strong>File:</strong> <span id="editImageFilename"></span><br>
                                <strong>Size:</strong> <span id="editImageSize"></span><br>
                                <strong>Type:</strong> <span id="editImageType"></span>
                            </small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <form id="imageEditForm">
                            <input type="hidden" id="editImageIndex">
                            <input type="hidden" id="editImageEventId">
                            <input type="hidden" id="editImageId">

                            <div class="form-group">
                                <label for="editImageDescription">Description</label>
                                <textarea class="form-control" id="editImageDescription" rows="5"
                                    placeholder="Enter a detailed description for this image..."></textarea>
                                <small class="form-text text-muted">This description will be shown to visitors viewing
                                    the gallery.</small>
                            </div>

                            <div class="form-group">
                                <label for="editImageOrder">Display Order</label>
                                <input type="number" class="form-control" id="editImageOrder" min="1"
                                    placeholder="Order position">
                                <small class="form-text text-muted">Lower numbers appear first in the gallery.</small>
                            </div>

                            <div class="form-group">
                                <label>Replace Image (Optional)</label>
                                <input type="file" class="form-control" id="editImageReplace" accept="image/*">
                                <small class="form-text text-muted">Select a new image to replace the current
                                    one.</small>
                            </div>

                            <div class="form-group">
                                <div class="d-flex justify-content-between align-items-center">
                                    <label class="mb-0">Actions</label>
                                    <div>
                                        <button type="button" class="btn btn-sm btn-outline-warning"
                                            onclick="rotateImage()">
                                            <i class="fas fa-undo"></i> Rotate
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-info"
                                            onclick="previewImageChanges()">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="text-end mt-3">
                    <button type="button" class="btn btn-secondary-admin"
                        onclick="closeImageEditorModal()">Cancel</button>
                    <button type="button" class="btn btn-danger-admin" onclick="deleteImageFromEditor()"
                        id="deleteImageBtn">
                        <i class="fas fa-trash"></i> Delete Image
                    </button>
                    <button type="button" class="btn-primary-admin" onclick="saveImageChanges()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Management Modal -->
    <div id="galleryManagementModal" class="modal-admin" style="display: none;">
        <div class="modal-content-admin" style="max-width: 95%; max-height: 95%;">
            <div class="modal-header-admin">
                <h4 class="modal-title">Gallery Management - <span id="galleryEventTitle">Event</span></h4>
                <button class="close-modal" onclick="closeGalleryManagementModal()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                <div class="gallery-management-toolbar mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="selectAllImages()">
                                <i class="fas fa-check-square"></i> Select All
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm"
                                onclick="deselectAllImages()">
                                <i class="fas fa-square"></i> Deselect All
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" onclick="bulkEditSelected()">
                                <i class="fas fa-edit"></i> Bulk Edit
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-sm"
                                onclick="deleteSelectedImages()">
                                <i class="fas fa-trash"></i> Delete Selected
                            </button>
                        </div>
                        <div>
                            <span class="badge badge-info" id="selectedImageCount">0 selected</span>
                            <span class="badge badge-secondary" id="totalImageCount">0 total</span>
                        </div>
                    </div>
                </div>

                <div class="row" id="galleryManagementGrid">
                    <!-- Gallery items will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Budget Events Modal -->
    <div id="budgetEventModal" class="modal-admin" style="display: none;">
        <div class="modal-content-admin">
            <div class="modal-header-admin">
                <h4 class="modal-title" id="budgetEventModalTitle">Add Budget Event</h4>
                <button class="close-modal" onclick="closeBudgetEventModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="budgetEventForm" enctype="multipart/form-data">
                    <input type="hidden" id="budgetEventId" name="budget_event_id">
                    <div class="form-group">
                        <label for="beTitle">Title</label>
                        <input type="text" class="form-control" id="beTitle" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="beDate">Event Date</label>
                        <input type="date" class="form-control" id="beDate" name="event_date">
                    </div>
                    <div class="form-group">
                        <label for="beBanner">Banner Image</label>
                        <input type="file" class="form-control" id="beBanner" name="banner_image" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label>Gallery Images</label>
                        <div class="d-flex gap-2 mb-2">
                            <input type="file" class="form-control" id="budget_gallery_images" multiple accept="image/*"
                                onchange="handleBudgetGalleryFiles(this)">
                            <button type="button" class="btn btn-sm btn-outline-secondary"
                                onclick="addSingleBudgetImage()">Add Image</button>
                            <button type="button" class="btn btn-sm btn-outline-danger"
                                onclick="clearBudgetGalleryImages()">Clear All</button>
                        </div>
                        <small class="form-text text-muted">Add images with captions for this budget event.</small>
                        <div class="row mt-2" id="budget-gallery-images-list"></div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary-admin"
                            onclick="closeBudgetEventModal()">Cancel</button>
                        <button type="button" class="btn-primary-admin" onclick="saveBudgetEvent()">Save Budget
                            Event</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Images to Budget Event Modal -->
    <div id="budgetEventImagesModal" class="modal-admin" style="display: none;">
        <div class="modal-content-admin">
            <div class="modal-header-admin">
                <h4 class="modal-title">Add Images to Budget Event</h4>
                <button class="close-modal" onclick="closeBudgetEventImagesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="budgetEventImagesForm" enctype="multipart/form-data">
                    <input type="hidden" id="budgetEventImagesEventId">
                    <div class="form-group">
                        <label>Gallery Images</label>
                        <input type="file" class="form-control" id="beImagesInput" multiple accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="beImagesDescriptions">Descriptions (one per image, line by line)</label>
                        <textarea class="form-control" id="beImagesDescriptions" rows="4"></textarea>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary-admin"
                            onclick="closeBudgetEventImagesModal()">Cancel</button>
                        <button type="button" class="btn-primary-admin" onclick="addImagesToBudgetEvent()">Add
                            Images</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- VIP Modals -->
    <div id="vipModal" class="modal-admin" style="display: none;">
        <div class="modal-content-admin">
            <div class="modal-header-admin">
                <h4 class="modal-title" id="vipModalTitle">Add New VIP</h4>
                <button class="close-modal" onclick="closeVipModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="vipForm" enctype="multipart/form-data">
                    <input type="hidden" id="vipId" name="vip_id">
                    <div class="form-group">
                        <label for="vipName">Title</label>
                        <input type="text" class="form-control" id="vipName" name="name">
                    </div>
                    <div class="form-group">
                        <label for="vipDescription">Description</label>
                        <textarea class="form-control" id="vipDescription" name="description" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="vipImage">Image</label>
                        <input type="file" class="form-control" id="vipImage" name="image" accept="image/*">
                        <small class="form-text text-muted">Upload an image (optional)</small>
                    </div>
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="vipIsActive" name="is_active"
                                value="true" checked>
                            <label class="custom-control-label" for="vipIsActive">Active</label>
                        </div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary-admin" onclick="closeVipModal()">Cancel</button>
                        <button type="button" class="btn-primary-admin" onclick="saveVip()">Save VIP</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalOverlay" class="modal-admin">
        <div class="modal-content-admin">
            <div class="modal-header-admin">
                <h4 class="modal-title" id="modalTitle">Modal Title</h4>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Modal content will be loaded dynamically -->
            </div>
        </div>
    </div>
    <script src="https://kit.fontawesome.com/97346fd324.js" crossorigin="anonymous"></script>
    <script>
        // Dashboard JavaScript
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize dashboard
            updateLastUpdated();
            loadDashboardData();

            // Mobile sidebar toggle
            const mobileToggle = document.getElementById('mobileToggle');
            const sidebar = document.getElementById('adminSidebar');
            const main = document.getElementById('adminMain');

            mobileToggle.addEventListener('click', function () {
                sidebar.classList.toggle('active');
            });

            // Navigation
            const navItems = document.querySelectorAll('.nav-item[data-section]');
            navItems.forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Remove active class from all nav items
                    navItems.forEach(nav => nav.classList.remove('active'));

                    // Add active class to clicked item
                    this.classList.add('active');

                    // Show corresponding section
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function (e) {
                if (window.innerWidth <= 768) {
                    if (!sidebar.contains(e.target) && !mobileToggle.contains(e.target)) {
                        sidebar.classList.remove('active');
                    }
                }
            });
        });

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = now.toLocaleString();
        }

        function loadDashboardData() {
            // Load real data from the page
            const exportInquiriesCount = parseInt('{{ export_inquiries|length }}');
            const importInquiriesCount = parseInt('{{ import_inquiries|length }}');
            const businessOpportunitiesCount = parseInt('{{ business_opportunities|length }}');
            const suggestionsCount = parseInt('{{ suggestions|length }}');
            const complaintsCount = parseInt('{{ complaints|length }}');

            const totalInquiries = exportInquiriesCount + importInquiriesCount + businessOpportunitiesCount + suggestionsCount + complaintsCount;

            document.getElementById('totalMembers').textContent = '1,247'; // This would need to be updated with real member count
            document.getElementById('activeEvents').textContent = '8'; // This would need to be updated with real event count

            // Load brochure count dynamically
            loadBrochureCount();
            document.getElementById('pendingInquiries').textContent = totalInquiries.toString();
            document.getElementById('totalRevenue').textContent = '$45,230'; // This would need to be updated with real revenue data
        }

        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Load section data
            loadSectionData(sectionName);
        }

        function loadMembersData() {
            // Simulate loading members data
            const membersTable = document.getElementById('membersTable');
            if (membersTable) {
                membersTable.innerHTML = `
                <tr>
                    <td>John Doe</td>
                    <td>ABC Corporation</td>
                    <td>john@abc.com</td>
                    <td>Premium</td>
                    <td><span class="status-badge approved">Active</span></td>
                    <td>
                        <div class="btn-group-admin">
                            <button class="btn btn-sm btn-outline-primary">Edit</button>
                            <button class="btn btn-sm btn-outline-danger">Delete</button>
                        </div>
                    </td>
                </tr>
            `;
            }
        }

        ////////////////////////////////////////Brochure Function //////////////////////////////////////////////////////
        function loadBrochureData() {
            const brochureTable = document.getElementById('brochureTable');
            brochureTable.innerHTML = '<tr><td colspan="8" class="text-center"><div class="loading-spinner"></div> Loading Brochure...</td></tr>';

            fetch('/get-brochure')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        brochureTable.innerHTML = '';
                        data.brochure.forEach(inquiry => {
                            brochureTable.innerHTML += `
                        <tr>
                            <td>${inquiry.name || 'N/A'}</td>
                            <td>${inquiry.email || 'N/A'}</td>
                            <td>${inquiry.phone || 'N/A'}</td>
                            <td>${inquiry.company || 'N/A'}</td>
                            <td>${inquiry.country || 'N/A'}</td>
                            <td>${inquiry.interest || 'N/A'}</td>
                            <td>${inquiry.submitted_at || 'N/A'}</td>
                            <td>
                                <div class="btn-group-admin">
                                    <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${inquiry.id}">Delete</button>
                                </div>
                            </td>
                        </tr>
                    `;
                        });

                        // Update the brochure count in the summary
                        document.getElementById('brochureCount').textContent = data.brochure.length.toString();

                        // Add brochure button listeners after buttons are created
                        addBrochureButtonListeners();
                    } else {
                        brochureTable.innerHTML = '<tr><td colspan="8" class="text-center">Error loading brochure</td></tr>';
                    }
                })
                .catch(error => {
                    brochureTable.innerHTML = '<tr><td colspan="8" class="text-center">Error loading brochure</td></tr>';
                });
        }



        function loadBrochureCount() {
            fetch('/get-brochure')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById('activeBrochure').textContent = data.brochure.length.toString();
                        // Also update the summary count if the element exists
                        const brochureCountElement = document.getElementById('brochureCount');
                        if (brochureCountElement) {
                            brochureCountElement.textContent = data.brochure.length.toString();
                        }
                    }
                })
                .catch(error => {
                    // Error handling without console.log
                });
        }

        ////////////////////////////////////////Brochure Function //////////////////////////////////////////////////////

        function addBrochureButtonListeners() {
            // Add delete button listeners for brochure inquiries
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const inquiryId = this.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this brochure inquiry?')) {
                        fetch(`/delete-brochure/${inquiryId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        })
                            .then(res => res.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    loadBrochureData(); // refresh table
                                    alert('Brochure inquiry deleted successfully!');
                                } else {
                                    alert('Error deleting brochure inquiry: ' + data.message);
                                }
                            })
                            .catch(error => {
                                alert('Error deleting brochure inquiry');
                            });
                    }
                });
            });
        }



        function addEventButtonListeners() {
            // Add delete button listeners
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const eventId = this.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this event?')) {
                        fetch(`/delete-event/${eventId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        })
                            .then(res => res.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    loadEventsData(); // refresh table
                                    alert('Event deleted successfully!');
                                } else {
                                    alert('Error deleting event: ' + data.message);
                                }
                            })
                            .catch(error => {
                                alert('Error deleting event');
                            });
                    }
                });
            });

            // Add edit button listeners
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const eventId = this.getAttribute('data-id');
                    openEditModal(eventId);
                });
            });
        }

        function openEditModal(eventId) {
            // Fetch event data first
            fetch(`/get-event/${eventId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const event = data.event;
                        const modal = document.getElementById('modalOverlay');
                        const modalTitle = document.getElementById('modalTitle');
                        const modalBody = document.getElementById('modalBody');

                        modalTitle.textContent = 'Edit Event';
                        modalBody.innerHTML = `
                        <form id="editEventForm">
                            <input type="hidden" id="editEventId" value="${event.id}">
                            <div class="mb-3">
                                <label class="form-label">Event Title</label>
                                <input type="text" class="form-control" id="editEventTitle" value="${event.title}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Date & Time</label>
                                <input type="datetime-local" class="form-control" id="editEventDate" value="${event.date_input}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-control" id="editEventLocation" value="${event.location}" required>
                            </div>
                            <div class="text-end">
                                <button type="button" class="btn btn-secondary-admin" onclick="closeModal()">Cancel</button>
                                <button type="submit" class="btn-primary-admin">Update Event</button>
                            </div>
                        </form>
                    `;
                        modal.style.display = 'block';

                        // Add form submit handler for edit
                        document.getElementById('editEventForm').addEventListener('submit', function (e) {
                            e.preventDefault();

                            const title = document.getElementById('editEventTitle').value;
                            const date = document.getElementById('editEventDate').value;
                            const location = document.getElementById('editEventLocation').value;

                            fetch(`/update-event/${eventId}`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                                body: new URLSearchParams({ title, date, location })
                            })
                                .then(res => res.json())
                                .then(data => {
                                    if (data.status === 'success') {
                                        closeModal();
                                        loadEventsData(); // Reload table
                                        alert('Event updated successfully!');
                                    } else {
                                        alert('Error: ' + data.message);
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    alert('Error updating event');
                                });
                        });
                    } else {
                        alert('Error loading event data');
                    }
                })
                .catch(error => {
                    alert('Error loading event data');
                });
        }

        function loadSectionData(sectionName) {
            switch (sectionName) {
                case 'export-inquiries':
                    // Data is already loaded via Jinja2 template
                    break;
                case 'import-inquiries':
                    // Data is already loaded via Jinja2 template
                    break;
                case 'business-opportunities':
                    // Data is already loaded via Jinja2 template
                    break;
                case 'suggestions':
                    // Data is already loaded via Jinja2 template
                    break;
                case 'complaints':
                    // Data is already loaded via Jinja2 template
                    break;
                case 'members':
                    loadMembersData();
                    break;
                case 'events':
                    loadEventsData();
                    break;
                case 'brochure':
                    loadBrochureData();
                    break;
                case 'vip':
                    loadVipData();
                    break;
                case 'past-events':
                    loadPastEvents();
                    break;
                case 'budget-events':
                    loadBudgetEvents();
                    break;
                default:
                    break;
            }
        }

        function viewDetails(type, id) {
            // Fetch details via AJAX
            fetch(`/api/${type}/${id}`)
                .then(response => response.json())
                .then(data => {
                    showDetailsModal(data, type);
                })
                .catch(error => {
                    alert('Error loading details');
                });
        }

        function showDetailsModal(data, type) {
            const modal = document.getElementById('modalOverlay');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            let title = '';
            let content = '';

            switch (type) {
                case 'export-inquiry':
                    title = 'Export Inquiry Details';
                    content = `
                        <div class="space-y-3">
                            <div><strong>Full Name:</strong> ${data.full_name}</div>
                            <div><strong>Company:</strong> ${data.company_name}</div>
                            <div><strong>Email:</strong> ${data.email}</div>
                            <div><strong>Phone:</strong> ${data.phone_number}</div>
                            <div><strong>Country:</strong> ${data.country}</div>
                            <div><strong>Product Quantity:</strong> ${data.product_quantity}</div>
                            <div><strong>Product Details:</strong> ${data.product_details}</div>
                            <div><strong>Export Requirements:</strong> ${data.export_requirements}</div>
                            <div><strong>Submitted:</strong> ${data.submitted_at}</div>
                        </div>
                    `;
                    break;
                case 'import-inquiry':
                    title = 'Import Inquiry Details';
                    content = `
                        <div class="space-y-3">
                            <div><strong>Full Name:</strong> ${data.full_name}</div>
                            <div><strong>Company:</strong> ${data.company_name}</div>
                            <div><strong>Email:</strong> ${data.email}</div>
                            <div><strong>Phone:</strong> ${data.phone_number}</div>
                            <div><strong>Country:</strong> ${data.country}</div>
                            <div><strong>Product Quantity:</strong> ${data.product_quantity}</div>
                            <div><strong>Product Details:</strong> ${data.product_details}</div>
                            <div><strong>Sender Details:</strong> ${data.sender_details}</div>
                            <div><strong>Submitted:</strong> ${data.submitted_at}</div>
                        </div>
                    `;
                    break;
                case 'business-opportunity':
                    title = 'Business Opportunity Details';
                    content = `
                        <div class="space-y-3">
                            <div><strong>Full Name:</strong> ${data.full_name}</div>
                            <div><strong>Email:</strong> ${data.email}</div>
                            <div><strong>Phone:</strong> ${data.phone_number}</div>
                            <div><strong>Business Opportunity:</strong> ${data.business_opportunity}</div>
                            <div><strong>Submitted:</strong> ${data.submitted_at}</div>
                        </div>
                    `;
                    break;
                case 'suggestion':
                    title = 'Suggestion Details';
                    content = `
                        <div class="space-y-3">
                            <div><strong>Full Name:</strong> ${data.full_name}</div>
                            <div><strong>Email:</strong> ${data.email}</div>
                            <div><strong>Phone:</strong> ${data.phone_number}</div>
                            <div><strong>Suggestion:</strong> ${data.suggestions}</div>
                            <div><strong>Submitted:</strong> ${data.submitted_at}</div>
                        </div>
                    `;
                    break;
                case 'complaint':
                    title = 'Complaint Details';
                    content = `
                        <div class="space-y-3">
                            <div><strong>Full Name:</strong> ${data.full_name}</div>
                            <div><strong>Email:</strong> ${data.email}</div>
                            <div><strong>Phone:</strong> ${data.phone_number}</div>
                            <div><strong>Complaint:</strong> ${data.complaints}</div>
                            <div><strong>Submitted:</strong> ${data.submitted_at}</div>
                        </div>
                    `;
                    break;
            }

            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            modal.style.display = 'block';
        }

        function approveInquiry(type, id) {
            if (confirm('Are you sure you want to approve this item?')) {
                // Implement approval logic
                alert('Item approved successfully!');
            }
        }

        function deleteInquiry(type, id) {
            if (confirm('Are you sure you want to delete this item?')) {
                fetch(`/api/${type}/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Item deleted successfully!');
                            location.reload();
                        } else {
                            alert('Error deleting item');
                        }
                    })
                    .catch(error => {
                        alert('Error deleting item');
                    });
            }
        }

        function openModal(modalType) {
            const modal = document.getElementById('modalOverlay');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            // Set modal content based on type
            switch (modalType) {
                case 'addMember':
                    modalTitle.textContent = 'Add New Member';
                    modalBody.innerHTML = `
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Membership Type</label>
                            <select class="form-control">
                                <option>Basic</option>
                                <option>Premium</option>
                                <option>Enterprise</option>
                            </select>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary-admin" onclick="closeModal()">Cancel</button>
                            <button type="submit" class="btn-primary-admin">Add Member</button>
                        </div>
                    </form>
                `;
                    break;
                case 'addEvent':
                    modalTitle.textContent = 'Create New Event';
                    modalBody.innerHTML = `
                    <form id="addEventForm">
                        <div class="mb-3">
                            <label class="form-label">Event Title</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Date & Time</label>
                            <input type="datetime-local" class="form-control" id="eventDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" id="eventLocation" required>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary-admin" onclick="closeModal()">Cancel</button>
                            <button type="submit" class="btn-primary-admin">Create Event</button>
                        </div>
                    </form>
                `;
                    break;
                case 'addPastEvent':
                    modalTitle.textContent = 'Add Past Event';
                    modalBody.innerHTML = `
                    <form id="addPastEventForm">
                        <div class="mb-3">
                            <label class="form-label">Event Title</label>
                            <input type="text" class="form-control" id="pastEventTitle" required>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Morning Event</label>
                                <input type="text" class="form-control" id="morningEvent" placeholder="Morning Event">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Afternoon Event</label>
                                <input type="text" class="form-control" id="afternoonEvent" placeholder="Afternoon Event">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Evening Event</label>
                                <input type="text" class="form-control" id="eveningEvent" placeholder="Evening Event">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="pastEventDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" id="pastEventLocation" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="pastEventDescription" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary-admin" onclick="closeModal()">Cancel</button>
                            <button type="submit" class="btn-primary-admin">Add Past Event</button>
                        </div>
                    </form>
                `;
                    break;

                // Add more modal types as needed
            }

            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
            resetGalleryUpload();
        }

        function exportToCSV(type) {
            // Implement CSV export functionality
            alert('Exporting ' + type + ' to CSV...');
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('modalOverlay');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Enhanced Gallery Management Variables
        let selectedGalleryFiles = [];
        let galleryDescriptions = [];
        let galleryEditMode = false;
        let maxGalleryImages = 30;
        let currentViewMode = 'grid'; // 'grid' or 'list'

        function handleGalleryFiles(input) {
            const files = Array.from(input.files);
            const remainingSlots = maxGalleryImages - selectedGalleryFiles.length;

            if (files.length > remainingSlots) {
                alert(`You can only add ${remainingSlots} more images. Maximum limit is ${maxGalleryImages} images.`);
                files.splice(remainingSlots);
            }

            selectedGalleryFiles = selectedGalleryFiles.concat(files);
            updateGalleryPreview();
            updateGalleryCount();
            console.log(`Gallery files changed: ${files.length} new files selected, total: ${selectedGalleryFiles.length}`);
        }

        function addSingleImage() {
            if (selectedGalleryFiles.length >= maxGalleryImages) {
                alert(`Maximum limit of ${maxGalleryImages} images reached.`);
                return;
            }

            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function () {
                if (this.files.length > 0) {
                    selectedGalleryFiles.push(this.files[0]);
                    galleryDescriptions.push(''); // Add empty description
                    updateGalleryPreview();
                    updateGalleryCount();
                    console.log(`Single image added: ${this.files[0].name}, total: ${selectedGalleryFiles.length}`);
                }
            };
            input.click();
        }

        function addBulkImages() {
            if (selectedGalleryFiles.length >= maxGalleryImages) {
                alert(`Maximum limit of ${maxGalleryImages} images reached.`);
                return;
            }

            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = true;
            const remainingSlots = maxGalleryImages - selectedGalleryFiles.length;

            input.onchange = function () {
                const files = Array.from(this.files);
                if (files.length > remainingSlots) {
                    alert(`You can only add ${remainingSlots} more images. Selecting first ${remainingSlots} files.`);
                    files.splice(remainingSlots);
                }

                // Show progress for bulk upload
                showUploadProgress(files.length);

                files.forEach((file, index) => {
                    selectedGalleryFiles.push(file);
                    galleryDescriptions.push(''); // Add empty description

                    // Update progress
                    setTimeout(() => {
                        updateProgressBar((index + 1) / files.length * 100, `Processing ${index + 1}/${files.length} files...`);
                        if (index === files.length - 1) {
                            hideUploadProgress();
                            updateGalleryPreview();
                            updateGalleryCount();
                        }
                    }, index * 100); // Stagger the updates
                });

                console.log(`Bulk images added: ${files.length}, total: ${selectedGalleryFiles.length}`);
            };
            input.click();
        }

        function clearGalleryImages() {
            if (selectedGalleryFiles.length === 0) return;

            if (confirm('Are you sure you want to clear all images? This action cannot be undone.')) {
                selectedGalleryFiles = [];
                galleryDescriptions = [];
                updateGalleryPreview();
                updateGalleryCount();
                const input = document.getElementById('gallery_images');
                if (input) input.value = '';
                console.log('All gallery images cleared');
            }
        }

        function updateGalleryCount() {
            const countElement = document.getElementById('gallery-count');
            if (countElement) {
                countElement.textContent = selectedGalleryFiles.length;
                countElement.className = selectedGalleryFiles.length >= maxGalleryImages ? 'badge badge-danger' : 'badge badge-info';
            }
        }

        function updateGalleryPreview() {
            const listElement = document.getElementById('gallery-images-list');
            const headerElement = document.getElementById('galleryHeader');

            if (!listElement) return;

            if (selectedGalleryFiles.length === 0) {
                listElement.innerHTML = '<div class="col-12 text-center text-muted py-4"><i class="fas fa-images fa-2x mb-2"></i><br>No images selected</div>';
                headerElement.style.display = 'none';
                return;
            }

            headerElement.style.display = 'flex';
            listElement.innerHTML = '';

            selectedGalleryFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const col = document.createElement('div');
                    col.className = currentViewMode === 'grid' ? 'col-lg-6 col-md-12 mb-3' : 'col-12 mb-2';

                    const currentDescription = galleryDescriptions[index] || '';

                    col.innerHTML = `
                        <div class="gallery-item-card" data-index="${index}">
                            <div class="gallery-item-header">
                                <img src="${e.target.result}" alt="Preview">
                                <div class="gallery-item-order">#${index + 1}</div>
                                <div class="gallery-item-controls">
                                    <button type="button" class="btn btn-sm btn-primary" onclick="editGalleryImage(${index})" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-warning" onclick="moveGalleryImage(${index}, 'up')" title="Move Up" ${index === 0 ? 'disabled' : ''}>
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-warning" onclick="moveGalleryImage(${index}, 'down')" title="Move Down" ${index === selectedGalleryFiles.length - 1 ? 'disabled' : ''}>
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger" onclick="removeGalleryImage(${index})" title="Remove">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <div class="image-status new">NEW</div>
                            </div>
                            <div class="gallery-item-body">
                                <div class="gallery-item-filename">${file.name}</div>
                                <textarea class="gallery-description-textarea" 
                                         placeholder="Enter description for this image..." 
                                         oninput="setGalleryDescription(${index}, this.value)"
                                         rows="2">${currentDescription}</textarea>
                                <div class="gallery-actions mt-2">
                                    <small class="text-muted">Size: ${formatFileSize(file.size)}</small>
                                    <span class="ms-auto">
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="saveGalleryImageDescription(${index})">
                                            <i class="fas fa-save"></i> Save
                                        </button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                    listElement.appendChild(col);
                };
                reader.readAsDataURL(file);
            });
        }

        function editGalleryImage(index) {
            const card = document.querySelector(`[data-index="${index}"]`);
            if (!card) return;

            card.classList.toggle('editing');
            const textarea = card.querySelector('.gallery-description-textarea');
            if (textarea) {
                textarea.focus();
                textarea.select();
            }
        }

        function moveGalleryImage(index, direction) {
            const newIndex = direction === 'up' ? index - 1 : index + 1;

            if (newIndex < 0 || newIndex >= selectedGalleryFiles.length) return;

            // Swap files and descriptions
            [selectedGalleryFiles[index], selectedGalleryFiles[newIndex]] = [selectedGalleryFiles[newIndex], selectedGalleryFiles[index]];
            [galleryDescriptions[index], galleryDescriptions[newIndex]] = [galleryDescriptions[newIndex], galleryDescriptions[index]];

            updateGalleryPreview();
            console.log(`Moved image from position ${index} to ${newIndex}`);
        }

        function removeGalleryImage(index) {
            if (confirm('Are you sure you want to remove this image?')) {
                selectedGalleryFiles.splice(index, 1);
                galleryDescriptions.splice(index, 1);
                updateGalleryPreview();
                updateGalleryCount();
                console.log(`Removed gallery image at index ${index}, remaining: ${selectedGalleryFiles.length}`);
            }
        }

        function saveGalleryImageDescription(index) {
            const card = document.querySelector(`[data-index="${index}"]`);
            if (!card) return;

            card.classList.remove('editing');
            const statusElement = card.querySelector('.image-status');
            if (statusElement) {
                statusElement.textContent = 'SAVED';
                statusElement.className = 'image-status edited';
            }

            // Show success animation
            const saveBtn = card.querySelector('.btn-outline-success');
            if (saveBtn) {
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
                saveBtn.classList.replace('btn-outline-success', 'btn-success');

                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                    saveBtn.classList.replace('btn-success', 'btn-outline-success');
                }, 1500);
            }
        }

        function resetGalleryUpload() {
            selectedGalleryFiles = [];
            galleryDescriptions = [];
            updateGalleryPreview();
            updateGalleryCount();
            const input = document.getElementById('gallery_images');
            if (input) input.value = '';
            hideUploadProgress();
        }

        function setGalleryDescription(index, text) {
            galleryDescriptions[index] = text || '';

            // Mark as edited
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card) {
                const statusElement = card.querySelector('.image-status');
                if (statusElement && statusElement.textContent !== 'SAVED') {
                    statusElement.textContent = 'EDITING';
                    statusElement.className = 'image-status edited';
                }
            }
        }

        function toggleGalleryView() {
            currentViewMode = currentViewMode === 'grid' ? 'list' : 'grid';
            const icon = document.getElementById('viewToggleIcon');
            const btn = icon.closest('button');

            if (currentViewMode === 'grid') {
                icon.className = 'fas fa-th';
                btn.innerHTML = '<i class="fas fa-th"></i> Grid View';
            } else {
                icon.className = 'fas fa-list';
                btn.innerHTML = '<i class="fas fa-list"></i> List View';
            }

            updateGalleryPreview();
        }

        function sortGalleryImages() {
            if (selectedGalleryFiles.length === 0) return;

            const sortOptions = [
                { value: 'name', text: 'Sort by Name (A-Z)' },
                { value: 'name-desc', text: 'Sort by Name (Z-A)' },
                { value: 'size', text: 'Sort by Size (Smallest First)' },
                { value: 'size-desc', text: 'Sort by Size (Largest First)' },
                { value: 'type', text: 'Sort by File Type' }
            ];

            const sortType = prompt(`Choose sorting option:\n${sortOptions.map((opt, i) => `${i + 1}. ${opt.text}`).join('\n')}\n\nEnter number (1-${sortOptions.length}):`);

            if (!sortType || sortType < 1 || sortType > sortOptions.length) return;

            const selectedOption = sortOptions[sortType - 1];
            sortGalleryBy(selectedOption.value);
        }

        function sortGalleryBy(type) {
            const combined = selectedGalleryFiles.map((file, index) => ({
                file,
                description: galleryDescriptions[index] || '',
                index
            }));

            combined.sort((a, b) => {
                switch (type) {
                    case 'name':
                        return a.file.name.localeCompare(b.file.name);
                    case 'name-desc':
                        return b.file.name.localeCompare(a.file.name);
                    case 'size':
                        return a.file.size - b.file.size;
                    case 'size-desc':
                        return b.file.size - a.file.size;
                    case 'type':
                        return a.file.type.localeCompare(b.file.type);
                    default:
                        return 0;
                }
            });

            selectedGalleryFiles = combined.map(item => item.file);
            galleryDescriptions = combined.map(item => item.description);

            updateGalleryPreview();
            console.log(`Gallery sorted by: ${type}`);
        }

        function previewGallery() {
            if (selectedGalleryFiles.length === 0) {
                alert('No images to preview');
                return;
            }

            // Create preview modal
            const modal = document.createElement('div');
            modal.className = 'modal-admin';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content-admin" style="max-width: 90%; max-height: 90%;">
                    <div class="modal-header-admin">
                        <h4>Gallery Preview (${selectedGalleryFiles.length} images)</h4>
                        <button class="close-modal" onclick="this.closest('.modal-admin').remove()">&times;</button>
                    </div>
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <div class="row">
                            ${selectedGalleryFiles.map((file, index) => `
                                <div class="col-lg-4 col-md-6 mb-3">
                                    <div class="card">
                                        <div style="height: 200px; overflow: hidden;">
                                            <img src="${URL.createObjectURL(file)}" 
                                                 alt="Preview ${index + 1}" 
                                                 style="width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                        <div class="card-body">
                                            <h6 class="card-title">Image ${index + 1}</h6>
                                            <p class="card-text small text-muted">${file.name}</p>
                                            ${galleryDescriptions[index] ? `<p class="card-text">${galleryDescriptions[index]}</p>` : '<p class="card-text text-muted">No description</p>'}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Drag and Drop functionality
        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function removeDragOver(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');

            const files = Array.from(event.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            const remainingSlots = maxGalleryImages - selectedGalleryFiles.length;

            if (files.length === 0) {
                alert('Please drop image files only.');
                return;
            }

            if (files.length > remainingSlots) {
                alert(`You can only add ${remainingSlots} more images. Selecting first ${remainingSlots} files.`);
                files.splice(remainingSlots);
            }

            selectedGalleryFiles = selectedGalleryFiles.concat(files);
            files.forEach(() => galleryDescriptions.push(''));

            updateGalleryPreview();
            updateGalleryCount();
            console.log(`Dropped ${files.length} files, total: ${selectedGalleryFiles.length}`);
        }

        // Progress bar functions
        function showUploadProgress(totalFiles) {
            const progressContainer = document.getElementById('uploadProgress');
            if (progressContainer) {
                progressContainer.style.display = 'block';
                updateProgressBar(0, `Preparing to process ${totalFiles} files...`);
            }
        }

        function updateProgressBar(percentage, text) {
            const progressBar = document.querySelector('#uploadProgress .progress-bar');
            const progressText = document.getElementById('progressText');

            if (progressBar) {
                progressBar.style.width = percentage + '%';
                progressBar.textContent = Math.round(percentage) + '%';
            }

            if (progressText) {
                progressText.textContent = text;
            }
        }

        function hideUploadProgress() {
            const progressContainer = document.getElementById('uploadProgress');
            if (progressContainer) {
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 500);
            }
        }

        // Utility functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Enhanced Image Editor Functions
        function openImageEditor(imageId, eventId, imagePath, description, displayOrder) {
            document.getElementById('editImageId').value = imageId || '';
            document.getElementById('editImageEventId').value = eventId || '';
            document.getElementById('editImageDescription').value = description || '';
            document.getElementById('editImageOrder').value = displayOrder || '';
            document.getElementById('editImagePreview').src = imagePath || '';

            // Show modal
            document.getElementById('imageEditorModal').style.display = 'block';
        }

        function closeImageEditorModal() {
            document.getElementById('imageEditorModal').style.display = 'none';
            document.getElementById('imageEditForm').reset();
        }

        function saveImageChanges() {
            const imageId = document.getElementById('editImageId').value;
            const eventId = document.getElementById('editImageEventId').value;
            const description = document.getElementById('editImageDescription').value;
            const displayOrder = document.getElementById('editImageOrder').value;
            const replaceFile = document.getElementById('editImageReplace').files[0];

            const formData = new FormData();
            formData.append('description', description);
            if (displayOrder) formData.append('display_order', displayOrder);
            if (replaceFile) formData.append('image_file', replaceFile);

            const url = imageId ? `/admin/past-events/images/${imageId}` : `/admin/past-events/${eventId}/images`;
            const method = imageId ? 'PUT' : 'POST';

            fetch(url, { method, body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closeImageEditorModal();
                        loadPastEvents(); // Refresh the events list
                        alert('Image updated successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to update image'));
                    }
                })
                .catch(() => alert('Error updating image'));
        }

        function deleteImageFromEditor() {
            const imageId = document.getElementById('editImageId').value;
            if (!imageId) {
                alert('No image to delete');
                return;
            }

            if (!confirm('Are you sure you want to delete this image? This action cannot be undone.')) {
                return;
            }

            fetch(`/admin/past-events/images/${imageId}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closeImageEditorModal();
                        loadPastEvents(); // Refresh the events list
                        alert('Image deleted successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to delete image'));
                    }
                })
                .catch(() => alert('Error deleting image'));
        }

        function rotateImage() {
            const img = document.getElementById('editImagePreview');
            const currentRotation = img.style.transform.match(/rotate\((\d+)deg\)/);
            const rotation = currentRotation ? (parseInt(currentRotation[1]) + 90) % 360 : 90;
            img.style.transform = `rotate(${rotation}deg)`;
        }

        function previewImageChanges() {
            const description = document.getElementById('editImageDescription').value;
            const replaceFile = document.getElementById('editImageReplace').files[0];

            if (replaceFile) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('editImagePreview').src = e.target.result;
                };
                reader.readAsDataURL(replaceFile);
            }

            // Show preview of description
            if (description) {
                alert(`Description Preview:\n"${description}"`);
            }
        }

        // Gallery Management Functions
        function openGalleryManagement(eventId, eventTitle) {
            document.getElementById('galleryEventTitle').textContent = eventTitle;
            document.getElementById('galleryManagementModal').style.display = 'block';
            loadGalleryManagementImages(eventId);
        }

        function closeGalleryManagementModal() {
            document.getElementById('galleryManagementModal').style.display = 'none';
        }

        function loadGalleryManagementImages(eventId) {
            fetch(`/admin/past-events/${eventId}/images`)
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        displayGalleryManagementImages(data.images);
                        updateImageCounts(data.images.length);
                    } else {
                        console.error('Failed to load images:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error loading gallery images:', error);
                });
        }

        function displayGalleryManagementImages(images) {
            const grid = document.getElementById('galleryManagementGrid');
            if (!images || images.length === 0) {
                grid.innerHTML = '<div class="col-12 text-center text-muted py-4"><i class="fas fa-images fa-2x mb-2"></i><br>No images found</div>';
                return;
            }

            grid.innerHTML = images.map(img => `
                <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                    <div class="gallery-management-item" data-image-id="${img.id}">
                        <div class="form-check position-absolute" style="top: 10px; left: 10px; z-index: 2;">
                            <input class="form-check-input image-checkbox" type="checkbox" value="${img.id}" onchange="updateSelectedCount()">
                        </div>
                        <div class="image-container" style="height: 150px; overflow: hidden; border-radius: 8px;">
                            <img src="${img.image_path}" alt="Gallery Image" style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;" 
                                 onclick="openImageEditor('${img.id}', '${img.past_event_id}', '${img.image_path}', '${img.description || ''}', '${img.display_order || ''}')">
                        </div>
                        <div class="image-details mt-2">
                            <small class="text-muted d-block">Order: ${img.display_order || 'Not set'}</small>
                            <small class="text-truncate d-block" title="${img.description || 'No description'}">${img.description || 'No description'}</small>
                        </div>
                        <div class="image-actions mt-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="openImageEditor('${img.id}', '${img.past_event_id}', '${img.image_path}', '${img.description || ''}', '${img.display_order || ''}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteGalleryImage('${img.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectAllImages() {
            document.querySelectorAll('.image-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectedCount();
        }

        function deselectAllImages() {
            document.querySelectorAll('.image-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const selected = document.querySelectorAll('.image-checkbox:checked').length;
            document.getElementById('selectedImageCount').textContent = `${selected} selected`;
        }

        function updateImageCounts(total) {
            document.getElementById('totalImageCount').textContent = `${total} total`;
        }

        function bulkEditSelected() {
            const selectedIds = Array.from(document.querySelectorAll('.image-checkbox:checked')).map(cb => cb.value);
            if (selectedIds.length === 0) {
                alert('Please select at least one image to edit.');
                return;
            }

            const newDescription = prompt('Enter new description for selected images (leave empty to keep current):');
            const newOrder = prompt('Enter starting order number for selected images (leave empty to keep current):');

            if (newDescription === null && newOrder === null) return; // User cancelled

            const promises = selectedIds.map((imageId, index) => {
                const formData = new FormData();
                if (newDescription !== null && newDescription !== '') {
                    formData.append('description', newDescription);
                }
                if (newOrder !== null && newOrder !== '') {
                    formData.append('display_order', parseInt(newOrder) + index);
                }

                return fetch(`/admin/past-events/images/${imageId}`, { method: 'PUT', body: formData });
            });

            Promise.all(promises)
                .then(responses => Promise.all(responses.map(r => r.json())))
                .then(results => {
                    const failed = results.filter(r => r.status !== 'success');
                    if (failed.length === 0) {
                        alert('All selected images updated successfully!');
                        loadPastEvents(); // Refresh
                        closeGalleryManagementModal();
                    } else {
                        alert(`${results.length - failed.length} images updated successfully, ${failed.length} failed.`);
                    }
                })
                .catch(() => alert('Error updating images'));
        }

        function deleteSelectedImages() {
            const selectedIds = Array.from(document.querySelectorAll('.image-checkbox:checked')).map(cb => cb.value);
            if (selectedIds.length === 0) {
                alert('Please select at least one image to delete.');
                return;
            }

            if (!confirm(`Are you sure you want to delete ${selectedIds.length} selected images? This action cannot be undone.`)) {
                return;
            }

            const promises = selectedIds.map(imageId =>
                fetch(`/admin/past-events/images/${imageId}`, { method: 'DELETE' })
            );

            Promise.all(promises)
                .then(responses => Promise.all(responses.map(r => r.json())))
                .then(results => {
                    const failed = results.filter(r => r.status !== 'success');
                    if (failed.length === 0) {
                        alert('All selected images deleted successfully!');
                        loadPastEvents(); // Refresh
                        closeGalleryManagementModal();
                    } else {
                        alert(`${results.length - failed.length} images deleted successfully, ${failed.length} failed.`);
                    }
                })
                .catch(() => alert('Error deleting images'));
        }

        function deleteGalleryImage(imageId) {
            if (!confirm('Are you sure you want to delete this image?')) return;

            fetch(`/admin/past-events/images/${imageId}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Reload the gallery management view
                        const eventId = document.getElementById('galleryEventTitle').textContent;
                        loadGalleryManagementImages(eventId);
                        alert('Image deleted successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to delete image'));
                    }
                })
                .catch(() => alert('Error deleting image'));
        }
        // VIP Management Functions
        function loadVipData() {
            fetch('/admin/vip/list')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        displayVips(data.vips);
                    } else {
                        console.error('Error loading VIPs:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function displayVips(vips) {
            const vipGrid = document.getElementById('vipGrid');
            if (!vipGrid) return;

            if (vips.length === 0) {
                vipGrid.innerHTML = '<div class="text-center p-4"><p class="text-muted">No VIPs found. Add your first VIP!</p></div>';
                return;
            }

            vipGrid.innerHTML = vips.map(vip => `
                <div class="vip-card" data-vip-id="${vip.id}">
                    <div class="vip-image">
                        ${vip.image_path ? `<img src="/static/${vip.image_path.replace('static/', '')}" alt="${vip.name}" onerror="this.src='/static/images/placeholder.jpg'">` : '<div class="no-image-placeholder">No Image</div>'}
                        <div class="vip-status ${vip.is_active ? 'active' : 'inactive'}">
                            ${vip.is_active ? 'Active' : 'Inactive'}
                        </div>
                    </div>
                    <div class="vip-info">
                        <h4>${vip.name || 'Untitled'}</h4>
                        ${vip.description ? `<p class="vip-description">${vip.description.substring(0, 150)}${vip.description.length > 150 ? '...' : ''}</p>` : ''}
                        <div class="vip-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="editVip(${vip.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteVip(${vip.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openAddVipModal() {
            document.getElementById('vipModalTitle').textContent = 'Add New VIP';
            document.getElementById('vipForm').reset();
            document.getElementById('vipId').value = '';
            document.getElementById('vipModal').style.display = 'block';
        }

        function editVip(vipId) {
            fetch(`/admin/vip/${vipId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const vip = data.vip;
                        document.getElementById('vipModalTitle').textContent = 'Edit VIP';
                        document.getElementById('vipId').value = vip.id;
                        document.getElementById('vipName').value = vip.name || '';
                        document.getElementById('vipDescription').value = vip.description || '';
                        document.getElementById('vipIsActive').checked = vip.is_active;
                        document.getElementById('vipImage').required = false; // Make image optional for editing
                        document.getElementById('vipModal').style.display = 'block';
                    } else {
                        alert('Error loading VIP details: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading VIP details');
                });
        }

        function saveVip() {
            const form = document.getElementById('vipForm');
            const formData = new FormData(form);
            const vipId = document.getElementById('vipId').value;

            const url = vipId ? '/admin/vip/update' : '/admin/vip/add';
            const method = 'POST';

            fetch(url, {
                method: method,
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        closeVipModal();
                        loadVipData();
                        alert(vipId ? 'VIP updated successfully!' : 'VIP added successfully!');
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error saving VIP');
                });
        }

        function deleteVip(vipId) {
            if (confirm('Are you sure you want to delete this VIP? This action cannot be undone.')) {
                fetch(`/admin/vip/${vipId}`, {
                    method: 'DELETE'
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            loadVipData();
                            alert('VIP deleted successfully!');
                        } else {
                            alert('Error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error deleting VIP');
                    });
            }
        }

        function closeVipModal() {
            document.getElementById('vipModal').style.display = 'none';
            document.getElementById('vipImage').required = true; // Reset image requirement
        }

        // ---------------- Past Events Admin JS ----------------
        function openAddPastEventModal() {
            document.getElementById('pastEventModalTitle').textContent = 'Add Past Event';
            document.getElementById('pastEventForm').reset();
            document.getElementById('pastEventId').value = '';
            resetGalleryUpload();
            document.getElementById('pastEventModal').style.display = 'block';
        }

        function closePastEventModal() {
            document.getElementById('pastEventModal').style.display = 'none';
            resetGalleryUpload();
        }

        function closePastEventImagesModal() {
            document.getElementById('pastEventImagesModal').style.display = 'none';
            document.getElementById('peImagesInput').value = '';
            document.getElementById('peImagesDescriptions').value = '';
        }

        function loadPastEvents() {
            fetch('/admin/past-events/list')
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'success') return;
                    const grid = document.getElementById('pastEventsGrid');
                    if (!grid) return;
                    if (!data.events || data.events.length === 0) {
                        grid.innerHTML = '<div class="text-center p-4"><p class="text-muted">No past events yet. Add your first one!</p></div>';
                        return;
                    }
                    grid.innerHTML = data.events.map(ev => `
                        <div class="vip-card" data-event-id="${ev.id}">
                            <div class="vip-image">
                                ${ev.banner_image_path ? `<img src="${ev.banner_image_path}" alt="${ev.title}" onerror="this.src='/static/images/placeholder.jpg'">` : '<div class="no-image-placeholder">No Banner</div>'}
                                <div class="vip-status ${ev.image_count > 0 ? 'active' : 'inactive'}">
                                    ${ev.image_count || 0} Images
                                </div>
                            </div>
                            <div class="vip-info">
                                <h4>${ev.title || 'Untitled'}</h4>
                                <p class="text-muted">${ev.event_date || ''}</p>
                                <small class="text-info">Created: ${new Date(ev.created_at).toLocaleDateString()}</small>
                                <div class="vip-actions mt-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="openEditPastEventModal(${ev.id})" title="Edit Event Details">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" onclick="openGalleryManagement(${ev.id}, '${ev.title}')" title="Manage Gallery">
                                        <i class="fas fa-images"></i> Gallery
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="openPastEventImagesModal(${ev.id})" title="Add More Images">
                                        <i class="fas fa-plus"></i> Add Images
                                    </button>
                                    <a class="btn btn-sm btn-outline-secondary" href="/past-events/${ev.id}" target="_blank" title="View Public Page">
                                        <i class="fas fa-external-link-alt"></i> View
                                    </a>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deletePastEvent(${ev.id})" title="Delete Event">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                })
                .catch(() => { });
        }

        function savePastEvent() {
            const formEl = document.getElementById('pastEventForm');
            const formData = new FormData();
            formData.append('title', document.getElementById('peTitle').value);
            formData.append('event_date', document.getElementById('peDate').value);
            const banner = document.getElementById('peBanner').files[0];
            if (banner) formData.append('banner_image', banner);

            // Gallery images and descriptions
            const galleryInput = document.getElementById('gallery_images');
            const files = []; // collect from selectedGalleryFiles if populated, else from input
            if (typeof selectedGalleryFiles !== 'undefined' && selectedGalleryFiles.length > 0) {
                selectedGalleryFiles.forEach(f => files.push(f));
            } else if (galleryInput && galleryInput.files) {
                Array.from(galleryInput.files).forEach(f => files.push(f));
            }
            files.forEach((file, idx) => {
                formData.append('gallery_images', file);
                const desc = (typeof galleryDescriptions !== 'undefined' && galleryDescriptions[idx]) ? galleryDescriptions[idx] : '';
                formData.append('gallery_descriptions', desc);
                formData.append('gallery_orders', String(idx));
            });

            fetch('/admin/past-events/create', { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closePastEventModal();
                        loadPastEvents();
                        alert('Past event created successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to create past event'));
                    }
                })
                .catch(() => { alert('Error creating past event'); });
        }

        function openPastEventImagesModal(eventId) {
            document.getElementById('pastEventImagesEventId').value = String(eventId);
            document.getElementById('pastEventImagesModal').style.display = 'block';
        }

        function addImagesToPastEvent() {
            const eventId = document.getElementById('pastEventImagesEventId').value;
            const files = document.getElementById('peImagesInput').files;
            const descText = document.getElementById('peImagesDescriptions').value || '';
            const lines = descText.split(/\r?\n/);

            const formData = new FormData();
            Array.from(files).forEach((file, idx) => {
                formData.append('gallery_images', file);
                formData.append('gallery_descriptions', lines[idx] || '');
                formData.append('gallery_orders', String(idx));
            });

            fetch(`/admin/past-events/${eventId}/images`, { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closePastEventImagesModal();
                        loadPastEvents();
                        alert('Images added successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to add images'));
                    }
                })
                .catch(() => { alert('Error adding images'); });
        }

        function deletePastEvent(eventId) {
            if (!confirm('Are you sure you want to delete this past event? This will remove all its images.')) return;
            fetch(`/admin/past-events/${eventId}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        loadPastEvents();
                        alert('Past event deleted successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to delete past event'));
                    }
                })
                .catch(() => { alert('Error deleting past event'); });
        }

        function openEditPastEventModal(eventId) {
            fetch(`/admin/past-events/${eventId}`)
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'success') { alert('Failed to load event'); return; }
                    const ev = data.event;
                    document.getElementById('pastEventModalTitle').textContent = 'Edit Past Event';
                    document.getElementById('pastEventForm').reset();
                    document.getElementById('pastEventId').value = ev.id;
                    document.getElementById('peTitle').value = ev.title || '';
                    document.getElementById('peDate').value = ev.event_date ? ev.event_date : '';
                    resetGalleryUpload();

                    // Load existing images for editing
                    loadExistingImagesForEdit(eventId);

                    document.getElementById('pastEventModal').style.display = 'block';
                })
                .catch(() => alert('Error loading event'));
        }

        // Function to load existing images when editing an event
        function loadExistingImagesForEdit(eventId) {
            fetch(`/admin/past-events/${eventId}/images`)
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success' && data.images.length > 0) {
                        displayExistingImagesInGallery(data.images);
                        updateGalleryCount();
                    }
                })
                .catch(error => {
                    console.error('Error loading existing images:', error);
                });
        }

        // Function to display existing images in the gallery preview for editing
        function displayExistingImagesInGallery(images) {
            const listElement = document.getElementById('gallery-images-list');
            const headerElement = document.getElementById('galleryHeader');

            if (!listElement || images.length === 0) return;

            headerElement.style.display = 'flex';
            listElement.innerHTML = '';

            // Clear any selected new files since we're showing existing images
            selectedGalleryFiles = [];
            galleryDescriptions = [];

            images.forEach((img, index) => {
                const col = document.createElement('div');
                col.className = currentViewMode === 'grid' ? 'col-lg-6 col-md-12 mb-3' : 'col-12 mb-2';

                col.innerHTML = `
                    <div class="gallery-item-card existing-image" data-image-id="${img.id}" data-index="${index}">
                        <div class="gallery-item-header">
                            <img src="${img.image_path}" alt="Existing Image" style="width: 100%; height: 120px; object-fit: cover;">
                            <div class="gallery-item-order">#${img.display_order || index + 1}</div>
                            <div class="gallery-item-controls">
                                <button type="button" class="btn btn-sm btn-success" onclick="editExistingImage('${img.id}', '${img.image_path}', '${img.description || ''}', '${img.display_order || index + 1}')" title="Edit Image">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-danger" onclick="deleteExistingImage('${img.id}', ${index})" title="Delete Image">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="image-status existing">EXISTING</div>
                        </div>
                        <div class="gallery-item-body">
                            <div class="gallery-item-filename">Existing Image ${index + 1}</div>
                            <textarea class="gallery-description-textarea" 
                                     placeholder="Enter description for this image..." 
                                     onchange="updateExistingImageDescription('${img.id}', this.value)"
                                     rows="2">${img.description || ''}</textarea>
                            <div class="gallery-actions mt-2">
                                <small class="text-muted">Created: ${new Date(img.created_at).toLocaleDateString()}</small>
                                <span class="ms-auto">
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="saveExistingImageDescription('${img.id}', ${index})">
                                        <i class="fas fa-save"></i> Update
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                listElement.appendChild(col);
            });

            // Update the gallery count to show existing images
            const countElement = document.getElementById('gallery-count');
            if (countElement) {
                countElement.textContent = images.length;
                countElement.className = 'badge badge-info';
            }
        }

        // Function to edit individual existing image
        function editExistingImage(imageId, imagePath, description, displayOrder) {
            // Use the enhanced image editor modal
            openImageEditor(imageId, null, imagePath, description, displayOrder);
        }

        // Function to update description of existing image
        function updateExistingImageDescription(imageId, description) {
            // Store the change but don't save yet - wait for user to click Update
            const card = document.querySelector(`[data-image-id="${imageId}"]`);
            if (card) {
                const statusElement = card.querySelector('.image-status');
                if (statusElement) {
                    statusElement.textContent = 'MODIFIED';
                    statusElement.className = 'image-status edited';
                }
            }
        }

        // Function to save existing image description
        function saveExistingImageDescription(imageId, index) {
            const card = document.querySelector(`[data-image-id="${imageId}"]`);
            if (!card) return;

            const textarea = card.querySelector('.gallery-description-textarea');
            const description = textarea.value;

            const formData = new FormData();
            formData.append('description', description);

            // Add loading state
            const saveBtn = card.querySelector('.btn-outline-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            saveBtn.disabled = true;

            fetch(`/admin/past-events/images/${imageId}`, { method: 'PUT', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Update status
                        const statusElement = card.querySelector('.image-status');
                        if (statusElement) {
                            statusElement.textContent = 'SAVED';
                            statusElement.className = 'image-status existing';
                        }

                        // Show success animation
                        saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
                        saveBtn.classList.replace('btn-outline-primary', 'btn-success');

                        setTimeout(() => {
                            saveBtn.innerHTML = originalText;
                            saveBtn.classList.replace('btn-success', 'btn-outline-primary');
                            saveBtn.disabled = false;
                        }, 2000);

                        showSuccessMessage('Image description updated successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to update image'));
                        saveBtn.innerHTML = originalText;
                        saveBtn.disabled = false;
                    }
                })
                .catch(() => {
                    alert('Error updating image description');
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                });
        }

        // Function to delete existing image
        function deleteExistingImage(imageId, index) {
            if (!confirm('Are you sure you want to delete this image? This action cannot be undone.')) {
                return;
            }

            fetch(`/admin/past-events/images/${imageId}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Remove the image card from display
                        const card = document.querySelector(`[data-image-id="${imageId}"]`);
                        if (card) {
                            card.remove();
                        }

                        // Update count
                        const countElement = document.getElementById('gallery-count');
                        if (countElement) {
                            const currentCount = parseInt(countElement.textContent) - 1;
                            countElement.textContent = currentCount;
                        }

                        showSuccessMessage('Image deleted successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to delete image'));
                    }
                })
                .catch(() => alert('Error deleting image'));
        }

        function updatePastEvent() {
            const eventId = document.getElementById('pastEventId').value;
            const formData = new FormData();
            formData.append('title', document.getElementById('peTitle').value);
            formData.append('event_date', document.getElementById('peDate').value);
            const banner = document.getElementById('peBanner').files[0];
            if (banner) formData.append('banner_image', banner);

            fetch(`/admin/past-events/${eventId}/update`, { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closePastEventModal();
                        loadPastEvents();
                        alert('Past event updated successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to update past event'));
                    }
                })
                .catch(() => alert('Error updating past event'));
        }

        // Override save button to switch between create/update
        (function hookSaveButton() {
            const saveBtn = document.querySelector('#pastEventModal .btn-primary-admin');
            if (!saveBtn) return;
            saveBtn.onclick = function () {
                const isEdit = !!document.getElementById('pastEventId').value;
                if (isEdit) {
                    updatePastEvent();
                } else {
                    savePastEvent();
                }
            };
        })();

        // ---------------- Budget Events Admin JS ----------------
        function openAddBudgetEventModal() {
            document.getElementById('budgetEventModalTitle').textContent = 'Add Budget Event';
            document.getElementById('budgetEventForm').reset();
            document.getElementById('budgetEventId').value = '';
            resetBudgetGalleryUpload();
            document.getElementById('budgetEventModal').style.display = 'block';
        }

        function closeBudgetEventModal() {
            document.getElementById('budgetEventModal').style.display = 'none';
            resetBudgetGalleryUpload();
        }

        function closeBudgetEventImagesModal() {
            document.getElementById('budgetEventImagesModal').style.display = 'none';
            document.getElementById('beImagesInput').value = '';
            document.getElementById('beImagesDescriptions').value = '';
        }

        function loadBudgetEvents() {
            fetch('/admin/budget-events/list')
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'success') return;
                    const grid = document.getElementById('budgetEventsGrid');
                    if (!grid) return;
                    if (!data.events || data.events.length === 0) {
                        grid.innerHTML = '<div class="text-center p-4"><p class="text-muted">No budget events yet. Add your first one!</p></div>';
                        return;
                    }
                    grid.innerHTML = data.events.map(ev => `
                        <div class="vip-card" data-event-id="${ev.id}">
                            <div class="vip-image">
                                ${ev.banner_image_path ? `<img src="${ev.banner_image_path}" alt="${ev.title}" onerror="this.src='/static/images/placeholder.jpg'">` : '<div class="no-image-placeholder">No Banner</div>'}
                            </div>
                            <div class="vip-info">
                                <h4>${ev.title || 'Untitled'}</h4>
                                <p class="text-muted">${ev.event_date || ''}</p>
                                <div class="vip-actions">
                                    <button class="btn btn-sm btn-outline-primary" onclick="openEditBudgetEventModal(${ev.id})">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="openBudgetEventImagesModal(${ev.id})">
                                        <i class="fas fa-images"></i> Add Images
                                    </button>
                                    <a class="btn btn-sm btn-outline-secondary" href="/Budget-Event-Details/${ev.id}" target="_blank">
                                        <i class="fas fa-external-link-alt"></i> View
                                    </a>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBudgetEvent(${ev.id})">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                })
                .catch(() => { });
        }

        function saveBudgetEvent() {
            const formData = new FormData();
            formData.append('title', document.getElementById('beTitle').value);
            formData.append('event_date', document.getElementById('beDate').value);
            const banner = document.getElementById('beBanner').files[0];
            if (banner) formData.append('banner_image', banner);

            const files = [];
            const galleryInput = document.getElementById('budget_gallery_images');
            if (typeof selectedBudgetGalleryFiles !== 'undefined' && selectedBudgetGalleryFiles.length > 0) {
                selectedBudgetGalleryFiles.forEach(f => files.push(f));
            } else if (galleryInput && galleryInput.files) {
                Array.from(galleryInput.files).forEach(f => files.push(f));
            }
            files.forEach((file, idx) => {
                formData.append('gallery_images', file);
                const desc = (typeof budgetGalleryDescriptions !== 'undefined' && budgetGalleryDescriptions[idx]) ? budgetGalleryDescriptions[idx] : '';
                formData.append('gallery_descriptions', desc);
                formData.append('gallery_orders', String(idx));
            });

            fetch('/admin/budget-events/create', { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closeBudgetEventModal();
                        loadBudgetEvents();
                        alert('Budget event created successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to create budget event'));
                    }
                })
                .catch(() => { alert('Error creating budget event'); });
        }

        function openBudgetEventImagesModal(eventId) {
            document.getElementById('budgetEventImagesEventId').value = String(eventId);
            document.getElementById('budgetEventImagesModal').style.display = 'block';
        }

        function addImagesToBudgetEvent() {
            const eventId = document.getElementById('budgetEventImagesEventId').value;
            const files = document.getElementById('beImagesInput').files;
            const descText = document.getElementById('beImagesDescriptions').value || '';
            const lines = descText.split(/\r?\n/);

            const formData = new FormData();
            Array.from(files).forEach((file, idx) => {
                formData.append('gallery_images', file);
                formData.append('gallery_descriptions', lines[idx] || '');
                formData.append('gallery_orders', String(idx));
            });

            fetch(`/admin/budget-events/${eventId}/images`, { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closeBudgetEventImagesModal();
                        loadBudgetEvents();
                        alert('Images added successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to add images'));
                    }
                })
                .catch(() => { alert('Error adding images'); });
        }

        function deleteBudgetEvent(eventId) {
            if (!confirm('Are you sure you want to delete this budget event? This will remove all its images.')) return;
            fetch(`/admin/budget-events/${eventId}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        loadBudgetEvents();
                        alert('Budget event deleted successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to delete budget event'));
                    }
                })
                .catch(() => { alert('Error deleting budget event'); });
        }

        function openEditBudgetEventModal(eventId) {
            fetch(`/admin/budget-events/${eventId}`)
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'success') { alert('Failed to load event'); return; }
                    const ev = data.event;
                    document.getElementById('budgetEventModalTitle').textContent = 'Edit Budget Event';
                    document.getElementById('budgetEventForm').reset();
                    document.getElementById('budgetEventId').value = ev.id;
                    document.getElementById('beTitle').value = ev.title || '';
                    document.getElementById('beDate').value = ev.event_date ? ev.event_date : '';
                    resetBudgetGalleryUpload();
                    document.getElementById('budgetEventModal').style.display = 'block';
                })
                .catch(() => alert('Error loading event'));
        }

        function updateBudgetEvent() {
            const eventId = document.getElementById('budgetEventId').value;
            const formData = new FormData();
            formData.append('title', document.getElementById('beTitle').value);
            formData.append('event_date', document.getElementById('beDate').value);
            const banner = document.getElementById('beBanner').files[0];
            if (banner) formData.append('banner_image', banner);

            fetch(`/admin/budget-events/${eventId}/update`, { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        closeBudgetEventModal();
                        loadBudgetEvents();
                        alert('Budget event updated successfully!');
                    } else {
                        alert('Error: ' + (data.message || 'Failed to update budget event'));
                    }
                })
                .catch(() => alert('Error updating budget event'));
        }

        // Budget gallery upload helpers
        let selectedBudgetGalleryFiles = [];
        const budgetGalleryDescriptions = [];
        function handleBudgetGalleryFiles(input) {
            const files = Array.from(input.files);
            selectedBudgetGalleryFiles = selectedBudgetGalleryFiles.concat(files);
            updateBudgetGalleryPreview();
        }
        function addSingleBudgetImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function () {
                if (this.files.length > 0) {
                    selectedBudgetGalleryFiles.push(this.files[0]);
                    updateBudgetGalleryPreview();
                }
            };
            input.click();
        }
        function clearBudgetGalleryImages() {
            selectedBudgetGalleryFiles = [];
            updateBudgetGalleryPreview();
            const input = document.getElementById('budget_gallery_images');
            if (input) input.value = '';
        }
        function setBudgetGalleryDescription(index, text) {
            budgetGalleryDescriptions[index] = text || '';
        }
        function updateBudgetGalleryPreview() {
            const listElement = document.getElementById('budget-gallery-images-list');
            if (listElement) {
                listElement.innerHTML = '';
                selectedBudgetGalleryFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const col = document.createElement('div');
                        col.className = 'col-12 mb-3';
                        col.innerHTML = `
                            <div class="card p-2">
                                <div class="d-flex align-items-start gap-3">
                                    <div style="width: 120px;">
                                        <img src="${e.target.result}" alt="Preview" class="img-fluid rounded" style="height: 80px; width: 120px; object-fit: cover;">
                                    </div>
                                    <div class="flex-grow-1">
                                        <label class="form-label">Description for ${file.name}</label>
                                        <textarea class="form-control" rows="2" oninput="setBudgetGalleryDescription(${index}, this.value)" placeholder="Write a description for this image..."></textarea>
                                    </div>
                                    <div>
                                        <button type="button" class="btn btn-sm btn-danger" onclick="removeBudgetGalleryImage(${index})"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                        `;
                        listElement.appendChild(col);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }
        function removeBudgetGalleryImage(index) {
            selectedBudgetGalleryFiles.splice(index, 1);
            updateBudgetGalleryPreview();
        }
        function resetBudgetGalleryUpload() {
            selectedBudgetGalleryFiles = [];
            updateBudgetGalleryPreview();
            const input = document.getElementById('budget_gallery_images');
            if (input) input.value = '';
        }

        // Initialize the enhanced gallery system
        document.addEventListener('DOMContentLoaded', function () {
            // Set up drag and drop area click handler
            const dragDropArea = document.getElementById('dragDropArea');
            if (dragDropArea) {
                dragDropArea.addEventListener('click', function () {
                    document.getElementById('gallery_images').click();
                });
            }

            // Initialize gallery count display
            updateGalleryCount();

            // Add keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                // Ctrl+Shift+G to open gallery management (when event is selected)
                if (e.ctrlKey && e.shiftKey && e.key === 'G') {
                    const selectedEvent = document.querySelector('.vip-card.selected');
                    if (selectedEvent) {
                        const eventId = selectedEvent.dataset.eventId;
                        const eventTitle = selectedEvent.querySelector('h4').textContent;
                        openGalleryManagement(eventId, eventTitle);
                    }
                }

                // ESC to close modals
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal-admin[style*="display: block"]');
                    modals.forEach(modal => modal.style.display = 'none');
                }
            });

            // Add click handlers for event card selection
            document.addEventListener('click', function (e) {
                const eventCard = e.target.closest('.vip-card');
                if (eventCard && !e.target.closest('.vip-actions')) {
                    // Remove previous selection
                    document.querySelectorAll('.vip-card.selected').forEach(card => {
                        card.classList.remove('selected');
                    });
                    // Add selection to clicked card
                    eventCard.classList.add('selected');
                }
            });

            // Load initial data
            loadPastEvents();

            console.log('Enhanced Past Events Management System initialized successfully!');
            console.log('Features enabled: Drag & Drop, Bulk Upload (30 images), Individual Image Editing, Gallery Management');
        });

        // Add visual feedback for successful operations
        function showSuccessMessage(message, duration = 3000) {
            const toast = document.createElement('div');
            toast.className = 'alert alert-success position-fixed';
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-check-circle me-2"></i>
                    <span>${message}</span>
                    <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, duration);
        }

        function showErrorMessage(message, duration = 5000) {
            const toast = document.createElement('div');
            toast.className = 'alert alert-danger position-fixed';
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span>${message}</span>
                    <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, duration);
        }
    </script>
</body>

</html>