{% extends "admin/auth_base.html" %}

{% block title %}Register{% endblock %}

{% block auth_title %}Create Account{% endblock %}

{% block auth_subtitle %}Join TACCI today{% endblock %}

{% block auth_content %}
<form method="POST" action="{{ url_for('main.register') }}" id="registerForm" novalidate>
    <div class="form-group">
        <label for="username" class="form-label">Username</label>
        <input type="text" id="username" name="username" class="form-input" placeholder="Choose a username" required>
        <div class="form-error" id="username-error"></div>
    </div>

    <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <input type="email" id="email" name="email" class="form-input" placeholder="Enter your email" required>
        <div class="form-error" id="email-error"></div>
    </div>

    <div class="form-group">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" name="password" class="form-input" placeholder="Create a password"
            required>
        <div class="form-error" id="password-error"></div>
        <div class="password-strength" id="password-strength"></div>
    </div>

    <div class="form-group">
        <label for="confirm_password" class="form-label">Confirm Password</label>
        <input type="password" id="confirm_password" name="confirm_password" class="form-input"
            placeholder="Confirm your password" required>
        <div class="form-error" id="confirm_password-error"></div>
    </div>

    <div class="form-group">
        <label for="role" class="form-label">Role</label>
        <select name="role" id="role" class="form-input" required>
            <option value="">Select your role</option>
            <option value="host">Host</option>
            <option value="member">Member</option>
        </select>
        <div class="form-error" id="role-error"></div>
    </div>

    <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
        <i class="fas fa-user-plus mr-2"></i>
        <span id="submitText">Create Account</span>
        <span id="loadingText" style="display: none;">
            <i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...
        </span>
    </button>
</form>

<div class="auth-footer">
    <p class="text-sm text-gray-600">
        Already have an account?
        <a href="{{ url_for('main.login') }}" class="text-blue-600 hover:text-blue-800 font-medium">
            Sign in here
        </a>
    </p>
</div>

<style>
    .password-strength {
        margin-top: 0.5rem;
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
    }

    .password-strength.weak {
        background-color: #fee2e2;
        color: #991b1b;
    }

    .password-strength.medium {
        background-color: #fef3c7;
        color: #92400e;
    }

    .password-strength.strong {
        background-color: #d1fae5;
        color: #065f46;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('registerForm');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const loadingText = document.getElementById('loadingText');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');

        // Clear previous errors when user starts typing
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', function () {
                clearFieldError(this);
            });
        });

        // Password strength checker
        password.addEventListener('input', function () {
            checkPasswordStrength(this.value);
        });

        // Password confirmation checker
        confirmPassword.addEventListener('input', function () {
            checkPasswordMatch();
        });

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            // Clear previous errors
            clearAllErrors();

            // Validate form
            if (validateForm()) {
                // Show loading state
                submitBtn.disabled = true;
                submitText.style.display = 'none';
                loadingText.style.display = 'inline';

                // Submit form
                form.submit();
            }
        });

        function validateForm() {
            let isValid = true;

            // Validate username
            const username = document.getElementById('username');
            if (!username.value.trim()) {
                showFieldError(username, 'Username is required');
                isValid = false;
            } else if (username.value.length < 3) {
                showFieldError(username, 'Username must be at least 3 characters');
                isValid = false;
            }

            // Validate email
            const email = document.getElementById('email');
            if (!email.value.trim()) {
                showFieldError(email, 'Email is required');
                isValid = false;
            } else if (!isValidEmail(email.value)) {
                showFieldError(email, 'Please enter a valid email address');
                isValid = false;
            }

            // Validate password
            if (!password.value.trim()) {
                showFieldError(password, 'Password is required');
                isValid = false;
            } else if (password.value.length < 6) {
                showFieldError(password, 'Password must be at least 6 characters');
                isValid = false;
            }

            // Validate confirm password
            if (!confirmPassword.value.trim()) {
                showFieldError(confirmPassword, 'Please confirm your password');
                isValid = false;
            } else if (password.value !== confirmPassword.value) {
                showFieldError(confirmPassword, 'Passwords do not match');
                isValid = false;
            }

            // Validate role
            const role = document.getElementById('role');
            if (!role.value) {
                showFieldError(role, 'Please select a role');
                isValid = false;
            }

            return isValid;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function checkPasswordStrength(password) {
            const strengthElement = document.getElementById('password-strength');
            let strength = 0;
            let message = '';
            let className = '';

            if (password.length >= 6) strength++;
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            if (strength < 3) {
                message = 'Weak password';
                className = 'weak';
            } else if (strength < 5) {
                message = 'Medium strength password';
                className = 'medium';
            } else {
                message = 'Strong password';
                className = 'strong';
            }

            strengthElement.textContent = message;
            strengthElement.className = 'password-strength ' + className;
        }

        function checkPasswordMatch() {
            const passwordValue = password.value;
            const confirmValue = confirmPassword.value;

            if (confirmValue && passwordValue !== confirmValue) {
                showFieldError(confirmPassword, 'Passwords do not match');
            } else {
                clearFieldError(confirmPassword);
            }
        }

        function showFieldError(field, message) {
            field.classList.add('error');
            const errorElement = document.getElementById(field.id + '-error');
            if (errorElement) {
                errorElement.textContent = message;
            }
        }

        function clearFieldError(field) {
            field.classList.remove('error');
            const errorElement = document.getElementById(field.id + '-error');
            if (errorElement) {
                errorElement.textContent = '';
            }
        }

        function clearAllErrors() {
            inputs.forEach(input => {
                clearFieldError(input);
            });
        }
    });
</script>
{% endblock %}